name: Luxury Events Data Collection

on:
  schedule:
    - cron: '0 6 * * *'
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  collect-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Create config file
      env:
        EVENTBRITE_API_KEY: ${{ secrets.EVENTBRITE_API_KEY }}
      run: |
        echo '{
          "api_keys": {
            "eventbrite": "'$EVENTBRITE_API_KEY'",
            "meetup": "",
            "facebook": ""
          },
          "target_cities": [
            "London", "Paris", "Milan", "Monaco", "Zurich"
          ],
          "categories": [
            "fashion", "finance", "automotive", "food_wine", "real_estate"
          ],
          "collection_frequency": 24,
          "min_luxury_score": 6
        }' > config.json
        
    - name: Run data collection
      run: |
        echo "🔄 Starting luxury events data collection..."
        python main.py
        echo "✅ Data collection completed"
        
    - name: List results
      run: |
        echo "📁 Generated files:"
        ls -la *.html *.db *.json || echo "Some files may be generated"
        
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: .
        
    - name: Success notification
      run: |
        echo "🎉 Workflow completed!"
        echo "📊 Dashboard: https://${{ github.repository_owner }}.github.io/luxury-events-intelligence/"
